{% extends "base.html" %}
{% block content %}
<h2>Comprador → Meus Pedidos</h2>
<table>
  <tr>
    <th>ID</th>
    <th>Fornecedor</th>
    <th>Status</th>
    <th>Total (R$)</th>
    <th>Criado</th>
    <th></th>
    <th></th>
  </tr>
  {% for o in orders %}
  {% set status_txt = o.status_exibido or o.status %}
  <tr>
    <td>#{{ o.id }}</td>
    <td>{{ o.supplier_name }}</td>
    <td>
      {% if status_txt == 'FATURADO' %}
        <span style="background:#fff4d6;border:1px solid #e6c200;color:#7a5a00;padding:2px 6px;border-radius:6px;">FATURADO</span>
      {% else %}
        {{ status_txt }}
      {% endif %}
    </td>
    <td>{{ '%.2f'|format(o.total) }}</td>
    <td class="muted">{{ o.created_at }}</td>
    <td><a class="btn small" href="{{ url_for('compras_detalhe', oid=o.id) }}">Ver detalhes</a></td>
    <td>
      {% if role == 'admin' %}
      <form method="post" action="{{ url_for('admin_orders_delete', oid=o.id) }}" onsubmit="return confirm('Excluir o pedido #{{ o.id }}? Esta ação não pode ser desfeita.');">
        <button class="btn small danger">Excluir</button>
      </form>
      {% endif %}
    </td>
  </tr>
  {% endfor %}
</table>
{% endblock %}
